<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://www.huana-nbp.go.th/index/add_file/P0D284NMon35557.png" type="image/png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- ****** Auto Complete ********* -->
    <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/ui-lightness/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå ‡∏≠‡∏ö‡∏ï.‡∏Ç‡πà‡∏≤‡πÉ‡∏´‡∏ç‡πà</title>

    <!-- ****** Style CSS ********* -->
    <style>
        input#employee {
            width: 282px;
            height: 60px;
            background-color: brown;
            color: yellow;
            margin-block-start: 5px;
            border-radius: 36px;
            font-size: 20px;
        }

        div#showtxt {
            font-size: 27px;
            margin-top: 20px;
        }

        @font-face {
            font-family: 'Digital dream Fat';
            src: url('https://semicon.github.io/fonts/DigitaldreamFat.woff2') format('woff2'),
                 url('https://semicon.github.io/fonts/DigitaldreamFat.woff') format('woff');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        @import url('https://fonts.googleapis.com/css2?family=K2D&family=Kanit&family=Sriracha&display=swap');

        * {
            margin: 0px;
            padding: 0px;
            box-sizing: border-box;
            font-family: 'K2D', sans-serif;
        }        body {
            font-family: 'Kanit', sans-serif;
            color: #444;
            background-color: white;
            padding: 20px;
            border: 2px solid white;
            box-shadow: 0px 8px 10px rgba(0, 0, 0, 0.5);
            font-size: 1.05rem;
            min-height: 100vh;
            display: flex;
            justify-content: center;            align-items: center;
            background-color: #92a8d1;
            background: url("https://images.unsplash.com/photo-1557804506-669a67965ba0?ixlib=rb-4.0.3");
            -webkit-background-size: cover;
            -moz-background-size: cover;
            -o-background-size: cover;
            background-size: cover;
        }

        input#employee {
            font-family: 'Kanit', sans-serif;
            width: 282px;
            height: 60px;
            background-color: brown;
            color: yellow;
            margin-block-start: 5px;
            border-radius: 36px;
            font-size: 20px;
        }

        .site-logo {
            content: url("https://www.huana-nbp.go.th/index/add_file/P0D284NMon35557.png");
            display: inline-block;
            margin-top: 20px;
            width: auto;
            height: 100px;
        }

        .msgBg {
            background-color: transparent;
        }

        .wrapper {
            background: rgba(221, 255, 255, 0.7);
            width: 350px;
            padding: 20px;
            border: 1px solid #999;
            border-radius: 5px;
            box-shadow: 0px 15px 20px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        /** #### digital clock #### **/
        .clock {
            font-family: Digital dream Fat;
            font-size: 28px;
            color: #00f6fa;
            letter-spacing: 3px;
            text-shadow: 1px 1px 2px teal, 0 0 25px green, 0 0 5px #00fbff;
            min-width: 98%;
            background: #444;
            padding: 5px 0px 5px 10px;
            display: inline-block;
            border: 3px solid #ccc;
            border-radius: 2px;
            outline-style: solid;
            outline-color: #999;
        }

        /* ===== ‡πÑ‡∏ü‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô ===== */
        .status-indicator {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .status-online {
            background: linear-gradient(45deg, #28a745, #20c997);
            box-shadow: 
                0 0 20px rgba(40, 167, 69, 0.6),
                0 0 40px rgba(40, 167, 69, 0.4),
                inset 0 1px 3px rgba(255, 255, 255, 0.3);
            animation: smooth-pulse-green 2s ease-in-out infinite;
        }

        .status-offline {
            background: linear-gradient(45deg, #dc3545, #e74c3c);
            box-shadow: 
                0 0 20px rgba(220, 53, 69, 0.6),
                0 0 40px rgba(220, 53, 69, 0.4),
                inset 0 1px 3px rgba(255, 255, 255, 0.3);
            animation: smooth-pulse-red 2s ease-in-out infinite;
        }

        .status-connecting {
            background: linear-gradient(45deg, #ffc107, #fd7e14);
            box-shadow: 
                0 0 20px rgba(255, 193, 7, 0.6),
                0 0 40px rgba(255, 193, 7, 0.4),
                inset 0 1px 3px rgba(255, 255, 255, 0.3);
            animation: smooth-pulse-yellow 1s ease-in-out infinite;
        }

        /* ‡∏™‡∏°‡∏π‡∏ó animations */
        @keyframes smooth-pulse-green {
            0%, 100% { 
                opacity: 1; 
                transform: scale(1);
                box-shadow: 
                    0 0 20px rgba(40, 167, 69, 0.6),
                    0 0 40px rgba(40, 167, 69, 0.4),
                    inset 0 1px 3px rgba(255, 255, 255, 0.3);
            }
            50% { 
                opacity: 0.7; 
                transform: scale(1.1);
                box-shadow: 
                    0 0 30px rgba(40, 167, 69, 0.8),
                    0 0 60px rgba(40, 167, 69, 0.6),
                    inset 0 1px 3px rgba(255, 255, 255, 0.3);
            }
        }

        @keyframes smooth-pulse-red {
            0%, 100% { 
                opacity: 1; 
                transform: scale(1);
                box-shadow: 
                    0 0 20px rgba(220, 53, 69, 0.6),
                    0 0 40px rgba(220, 53, 69, 0.4),
                    inset 0 1px 3px rgba(255, 255, 255, 0.3);
            }
            50% { 
                opacity: 0.7; 
                transform: scale(1.1);
                box-shadow: 
                    0 0 30px rgba(220, 53, 69, 0.8),
                    0 0 60px rgba(220, 53, 69, 0.6),
                    inset 0 1px 3px rgba(255, 255, 255, 0.3);
            }
        }

        @keyframes smooth-pulse-yellow {
            0%, 100% { 
                opacity: 1; 
                transform: scale(1);
                box-shadow: 
                    0 0 20px rgba(255, 193, 7, 0.6),
                    0 0 40px rgba(255, 193, 7, 0.4),
                    inset 0 1px 3px rgba(255, 255, 255, 0.3);
            }
            50% { 
                opacity: 0.8; 
                transform: scale(1.15);
                box-shadow: 
                    0 0 30px rgba(255, 193, 7, 0.8),
                    0 0 60px rgba(255, 193, 7, 0.6),
                    inset 0 1px 3px rgba(255, 255, 255, 0.3);
            }
        }

        /* Hover effect ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏ü */
        .status-indicator:hover {
            transform: scale(1.2);
            transition: transform 0.2s ease;
        }

        .version-info {
            position: fixed;
            bottom: 10px;
            right: 10px;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            background: rgba(0, 0, 0, 0.3);
            padding: 5px 10px;
            border-radius: 15px;
        }

        /* Autocomplete UI Styles */
        .ui-autocomplete {
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Kanit', sans-serif;
            font-size: 16px;
            z-index: 9999 !important;
        }

        .ui-menu-item {
            padding: 8px 12px;
        }

        .ui-menu-item:hover {
            background-color: #e3f2fd;
        }

        .ui-state-active,
        .ui-widget-content .ui-state-active {
            background: #2196f3;
            color: white;
            border: 1px solid #1976d2;
        }

        /* ===== SweetAlert2 Modern Styles ===== */
        .sweet-popup-modern {
            border-radius: 20px !important;
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3) !important;
        }

        .sweet-title-modern {
            font-size: 24px !important;
            font-weight: 600 !important;
            margin-bottom: 20px !important;
        }

        /* ===== SweetAlert2 ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô ===== */
        .government-popup {
            border-radius: 12px !important;
            font-family: 'Kanit', sans-serif !important;
        }

        .government-btn-confirm {
            border-radius: 6px !important;
            font-weight: 500 !important;
        }

        .government-btn-cancel {
            border-radius: 6px !important;
            font-weight: 500 !important;
        }

        /* Animation for location spinner */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Fade animations for SweetAlert */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translate3d(0, -100%, 0);
            }
            to {
                opacity: 1;
                transform: translate3d(0, 0, 0);
            }
        }

        @keyframes fadeOutUp {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
                transform: translate3d(0, -100%, 0);
            }
        }

        .animate__animated {
            animation-duration: 0.5s;
            animation-fill-mode: both;
        }

        .animate__fadeInDown {
            animation-name: fadeInDown;
        }

        .animate__fadeOutUp {
            animation-name: fadeOutUp;
        }

        /* ===== Employee Suggestion Popup ===== */
        .employee-suggestion-popup .swal2-html-container {
            text-align: left !important;
        }
        
        .employee-suggestion-popup [onclick^="selectSuggestedEmployee"]:hover {
            background-color: rgba(44, 90, 160, 0.1) !important;
            border-radius: 4px !important;
        }
    </style>
</head>

<!-- ******* Time Tracker HTML Body *********** -->
<body>
    <div class="wrapper text-center" style="max-width:350px">
        <!-- ‡πÑ‡∏ü‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô -->
        <div id="status-indicator" class="status-indicator status-connecting" title="‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠"></div>
        
        <div class="site-logo text-center"></div>
        <h5>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå ‡∏≠‡∏ö‡∏ï.‡∏Ç‡πà‡∏≤‡πÉ‡∏´‡∏ç‡πà</h5>

        <span id="MyClockDisplay" class="clock mt-3" onload="showTime()"></span>

        <form id="myForm">
            <div class="row mt-4">
                <div class="form-group col">
                    <label for="employee">‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™ </label>
                    <input id="employee" class="text-center"> <br>
                </div>
            </div>

            <div class="row mt-4">
                <div class="form-group col">
                    <label for="lblinfo"><i class="fas fa-book-reader"></i> ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°/‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</label>
                    <input type="search" class="form-control form-control-lg" id="userinfo" name="userinfo" list="list">
                    <datalist id="list">
                        <option value="‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£">‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</option>
                        <option value="‡∏•‡∏≤‡∏Å‡∏¥‡∏à">‡∏•‡∏≤‡∏Å‡∏¥‡∏à</option>
                        <option value="‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢">‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢</option>
                        <option value="‡∏•‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î">‡∏•‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î</option>
                    </datalist>
                </div>
            </div>

            <div class="row mt-4 g-2">
                <div class="col-6">
                    <button id="clockin" type="button" class="btn btn-lg btn-primary w-100">Clock In</button>
                </div>
                <div class="col-6">
                    <button id="clockout" type="button" class="btn btn-lg btn-warning w-100">Clock Out</button>
                </div>
            </div>

            <div class="row mt-4">
                <div class="form-group col">
                    <div class="alert" role="alert" id="message"></div>
                </div>
            </div>
        </form>
    </div>

    <!-- Version info -->
    <div class="version-info">
        <span id="app-version">v2.1.0</span> | 
        <span id="server-status">Songphon</span>
    </div>

    <script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
    <script>
        // VConsole ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö debug (‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞ development)
        // var vConsole = new window.VConsole();
    </script>

    <!-- ******* Javascript *********** -->
    <script>
        // ===== Configuration =====
        var isProduction = window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1';
        var apiUrl = isProduction ? 
            window.location.origin + '/api' : 
            'http://localhost:3000/api';
        
        var owner = '‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏≥‡∏ö‡∏•‡∏Ç‡πà‡∏≤‡πÉ‡∏´‡∏ç‡πà';
        var connectionRetryCount = 0;
        var maxRetries = 3;

        // GPS Variables - ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á
        var gps = null;
        var isGpsReady = false;
        var gpsWatchId = null;
        var hasRequestedPermission = false;

        console.log('üåê API URL:', apiUrl);
        console.log('üè¢ Environment:', isProduction ? 'Production' : 'Development');

        var profile;

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö server
        async function checkServerConnection() {
            try {
                const response = await fetch(apiUrl + '/health');
                const data = await response.json();
                
                if (response.ok && data.status === 'healthy') {
                    updateConnectionStatus('online');
                    connectionRetryCount = 0;
                    return true;
                } else {
                    throw new Error('Server unhealthy');
                }
            } catch (error) {
                console.error('‚ùå Connection check failed:', error);
                updateConnectionStatus('offline');
                
                if (connectionRetryCount < maxRetries) {
                    connectionRetryCount++;
                    setTimeout(checkServerConnection, 5000);
                    updateConnectionStatus('connecting');
                }
                
                return false;
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏ü - ‡πÅ‡∏Ñ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        function updateConnectionStatus(status) {
            const indicator = document.getElementById('status-indicator');
            
            // ‡∏•‡∏ö class ‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            indicator.classList.remove('status-online', 'status-offline', 'status-connecting');
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏° class ‡πÉ‡∏´‡∏°‡πà
            indicator.classList.add(`status-${status}`);
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó tooltip
            const statusText = {
                online: '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß',
                offline: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ',
                connecting: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...'
            };
            
            indicator.title = statusText[status] || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞';
            
            console.log(`üîò Status updated: ${status}`);
        }        // ======== GPS Functions - ‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏î‡πâ‡∏ß‡∏¢‡∏õ‡πá‡∏≠‡∏õ‡∏≠‡∏±‡∏û‡∏™‡∏ß‡∏¢ ========
        async function initializeGPS() {
            console.log('üìç Initializing GPS with modern popup...');

            if (!navigator.geolocation) {
                console.warn('‚ùå Geolocation not supported');
                getFallbackLocation();
                return;
            }

            // ‡πÑ‡∏°‡πà‡∏Ç‡∏≠‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÅ‡∏ö‡∏ö‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡πÜ ‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏∞‡∏Å‡∏î‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤
            console.log('üìç GPS initialization ready, waiting for user action...');
        }

        function onGpsSuccess(position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            const accuracy = position.coords.accuracy;
            
            gps = [lat, lon];
            isGpsReady = true;
            
            console.log(`‚úÖ GPS Ready: ${lat}, ${lon} (accuracy: ${Math.round(accuracy)}m)`);
        }

        function onGpsUpdate(position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            
            gps = [lat, lon];
            console.log(`üìç GPS Updated: ${lat}, ${lon}`);
        }        function onGpsError(error) {
            console.warn('‚ö†Ô∏è GPS Error:', error.code, error.message);
            
            // ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£ ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÅ‡∏Ñ‡πà log error ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÄ‡∏≠‡∏á
            console.log('üìç GPS error occurred, user will need to grant permission manually');
            isGpsReady = false;
            gps = null;
        }function getFallbackLocation() {
            console.log('üîÑ Using fallback location methods...');
            
            // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const urlLat = urlParams.get('lat');
            const urlLon = urlParams.get('lon');
            
            if (urlLat && urlLon) {
                gps = [parseFloat(urlLat), parseFloat(urlLon)];
                isGpsReady = true;
                console.log('üìç Using URL location:', gps);
                return;
            }
            
            // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: IP Geolocation
            fetch('https://ipapi.co/json/')
                .then(response => response.json())
                .then(data => {
                    if (data.latitude && data.longitude) {
                        gps = [data.latitude, data.longitude];
                        isGpsReady = true;
                        console.log('üìç Using IP location:', gps);
                    } else {
                        throw new Error('No location from IP');
                    }
                })
                .catch(error => {
                    console.warn('‚ö†Ô∏è IP location failed:', error);
                    
                    // ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô - ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î GPS ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
                    console.log('‚ùå No fallback location available');
                    isGpsReady = false;
                    gps = null;
                });
        }        // ======== SweetAlert2 GPS Permission ========
        async function requestGPSPermission() {
            hasRequestedPermission = true;
            
            const result = await Swal.fire({
                title: 'üåü ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á',
                html: `
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 80px; margin-bottom: 20px;">üìç</div>
                        <div style="font-size: 18px; color: #4a90e2; margin-bottom: 15px;">
                            ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥
                        </div>
                        <div style="font-size: 14px; color: #666; line-height: 1.6;">
                            ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì<br>
                            ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                        </div>
                    </div>
                `,
                icon: null,
                showCancelButton: true,
                confirmButtonText: '‚ú® ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï',
                cancelButtonText: '‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï',
                confirmButtonColor: '#28a745',
                cancelButtonColor: '#dc3545',
                background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                color: 'white',
                customClass: {
                    popup: 'sweet-popup-modern',
                    title: 'sweet-title-modern'
                },
                showClass: {
                    popup: 'animate__animated animate__fadeInDown'
                },
                hideClass: {
                    popup: 'animate__animated animate__fadeOutUp'
                },
                allowOutsideClick: false
            });

            if (result.isConfirmed) {
                // ‡πÅ‡∏™‡∏î‡∏á loading ‡∏™‡∏ß‡∏¢‡πÜ
                Swal.fire({
                    title: 'üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á',
                    html: `
                        <div style="text-align: center; padding: 20px;">
                            <div class="location-spinner" style="
                                width: 60px; 
                                height: 60px; 
                                border: 4px solid #f3f3f3; 
                                border-top: 4px solid #4a90e2; 
                                border-radius: 50%; 
                                animation: spin 1s linear infinite;
                                margin: 0 auto 20px;
                            "></div>
                            <div style="color: #4a90e2; font-size: 16px;">
                                ‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...
                            </div>
                        </div>
                        <style>
                            @keyframes spin {
                                0% { transform: rotate(0deg); }
                                100% { transform: rotate(360deg); }
                            }
                        </style>
                    `,
                    timer: 8000,
                    timerProgressBar: true,
                    showConfirmButton: false,
                    allowOutsideClick: false,
                    background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    color: 'white'
                });                // ‡∏Ç‡∏≠‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏° watch position
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        const accuracy = position.coords.accuracy;
                        
                        gps = [lat, lon];
                        isGpsReady = true;
                        hasRequestedPermission = true;
                        
                        console.log(`‚úÖ GPS Permission granted: ${lat}, ${lon}`);
                        
                        // ‡πÄ‡∏£‡∏¥‡πà‡∏° watch position ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏î‡πâ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÅ‡∏•‡πâ‡∏ß
                        gpsWatchId = navigator.geolocation.watchPosition(
                            onGpsUpdate,
                            onGpsError,
                            {
                                enableHighAccuracy: true,
                                timeout: 8000,
                                maximumAge: 30000
                            }
                        );
                        
                        Swal.fire({
                            title: 'üéâ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                            html: `
                                <div style="text-align: center; padding: 20px;">
                                    <div style="font-size: 60px; margin-bottom: 15px;">‚úÖ</div>
                                    <div style="font-size: 16px; color: #28a745; margin-bottom: 10px;">
                                        ‡∏û‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß
                                    </div>
                                    <div style="font-size: 14px; color: #666;">
                                        ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥: ${Math.round(accuracy)} ‡πÄ‡∏°‡∏ï‡∏£
                                    </div>
                                </div>
                            `,
                            icon: null,
                            timer: 2500,
                            showConfirmButton: false,
                            background: 'linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%)',
                            color: 'white'
                        });
                    },
                    (error) => {
                        console.error('‚ùå GPS Permission error:', error);
                        
                        Swal.fire({
                            title: '‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ',
                            html: `
                                <div style="text-align: center; padding: 20px;">
                                    <div style="font-size: 60px; margin-bottom: 15px;">‚ùå</div>
                                    <div style="font-size: 16px; color: #e74c3c; margin-bottom: 10px;">
                                        ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î GPS ‡πÅ‡∏•‡∏∞‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
                                    </div>
                                    <div style="font-size: 14px; color: #666; line-height: 1.5;">
                                        ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå<br>
                                        ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                                    </div>
                                </div>
                            `,
                            icon: null,
                            confirmButtonText: 'üîÑ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà',
                            confirmButtonColor: '#e74c3c',
                            background: 'linear-gradient(135deg, #ff6b6b 0%, #ffa8a8 100%)',
                            color: 'white'
                        });
                        
                        // ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ fallback location
                        isGpsReady = false;
                        gps = null;
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 15000,
                        maximumAge: 0
                    }
                );
            } else {
                // ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï
                Swal.fire({
                    title: 'üö´ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏î‡πâ',
                    html: `
                        <div style="text-align: center; padding: 20px;">
                            <div style="font-size: 60px; margin-bottom: 15px;">üö´</div>
                            <div style="font-size: 16px; color: #e74c3c; margin-bottom: 10px;">
                                ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤
                            </div>
                            <div style="font-size: 14px; color: #666;">
                                ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î GPS ‡πÅ‡∏•‡∏∞‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                            </div>
                        </div>
                    `,
                    icon: null,
                    confirmButtonText: 'üëç ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß',
                    confirmButtonColor: '#6c757d',
                    background: 'linear-gradient(135deg, #636363 0%, #a2a2a2 100%)',
                    color: 'white'
                });
                
                // ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ fallback location
                isGpsReady = false;
                gps = null;
            }        }

        // ======== GPS Permission - ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô (‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß) ========
        async function requestGPSPermission() {
            if (hasRequestedPermission && isGpsReady && gps) {
                return; // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏≤‡∏°‡∏ã‡πâ‡∏≥
            }
            
            hasRequestedPermission = true;
            
            const result = await Swal.fire({
                title: '‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á',
                html: `
                    <div style="text-align: center; padding: 15px;">
                        <div style="font-size: 64px; margin-bottom: 15px; color: #00a8cc;">üìç</div>
                        <div style="font-size: 16px; color: #2c5aa0; margin-bottom: 12px; font-weight: 500;">
                            ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥
                        </div>
                        <div style="font-size: 14px; color: #546e7a; line-height: 1.5;">
                            ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô<br>
                            ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                        </div>
                    </div>
                `,
                icon: null,
                showCancelButton: true,
                confirmButtonText: '‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï',
                cancelButtonText: '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï',
                confirmButtonColor: '#2c5aa0',
                cancelButtonColor: '#78909c',
                background: 'rgba(240, 248, 255, 0.95)',
                color: '#37474f',
                backdrop: 'rgba(0,0,0,0.3)',
                allowOutsideClick: false,
                width: '380px',
                padding: '25px'
            });

            if (result.isConfirmed) {
                // ‡πÅ‡∏™‡∏î‡∏á loading ‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
                const loadingPromise = Swal.fire({
                    title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á',
                    html: `
                        <div style="text-align: center; padding: 20px;">
                            <div style="
                                width: 40px; 
                                height: 40px; 
                                border: 3px solid #e3f2fd; 
                                border-top: 3px solid #2c5aa0; 
                                border-radius: 50%; 
                                animation: spin 1s linear infinite;
                                margin: 0 auto 15px;
                            "></div>
                            <div style="color: #546e7a; font-size: 14px;">
                                ‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...
                            </div>
                        </div>
                    `,
                    showConfirmButton: false,
                    allowOutsideClick: false,
                    background: 'rgba(240, 248, 255, 0.95)',
                    color: '#37474f',
                    width: '320px',
                    padding: '20px'
                });

                try {
                    const position = await new Promise((resolve, reject) => {
                        navigator.geolocation.getCurrentPosition(resolve, reject, {
                            enableHighAccuracy: true,
                            timeout: 15000,
                            maximumAge: 0
                        });
                    });

                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    const accuracy = position.coords.accuracy;
                    
                    gps = [lat, lon];
                    isGpsReady = true;
                    
                    console.log(`‚úÖ GPS Permission granted: ${lat}, ${lon}`);
                    
                    // ‡πÄ‡∏£‡∏¥‡πà‡∏° watch position
                    gpsWatchId = navigator.geolocation.watchPosition(
                        onGpsUpdate,
                        onGpsError,
                        {
                            enableHighAccuracy: true,
                            timeout: 8000,
                            maximumAge: 30000
                        }
                    );
                    
                    // ‡∏õ‡∏¥‡∏î loading ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                    Swal.close();
                    
                    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏ö‡∏ö toast ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡πÜ
                    const successToast = Swal.mixin({
                        toast: true,
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: 2500,
                        timerProgressBar: true,
                        background: 'rgba(76, 175, 80, 0.9)',
                        color: 'white',
                        width: '320px'
                    });
                    
                    successToast.fire({
                        title: `üìç ‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`,
                        text: `‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ ${Math.round(accuracy)} ‡πÄ‡∏°‡∏ï‡∏£`
                    });

                } catch (error) {
                    console.error('‚ùå GPS Permission error:', error);
                    
                    Swal.fire({
                        title: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ',
                        html: `
                            <div style="text-align: center; padding: 15px;">
                                <div style="font-size: 48px; margin-bottom: 15px; color: #f57c00;">‚ö†Ô∏è</div>
                                <div style="font-size: 16px; color: #d84315; margin-bottom: 10px;">
                                    ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ GPS
                                </div>
                                <div style="font-size: 14px; color: #546e7a; line-height: 1.5;">
                                    ‚Ä¢ ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô GPS ‡πÉ‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå<br>
                                    ‚Ä¢ ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå<br>
                                    ‚Ä¢ ‡∏•‡∏≠‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡∏°‡πà
                                </div>
                            </div>
                        `,
                        icon: null,
                        confirmButtonText: '‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß',
                        confirmButtonColor: '#2c5aa0',
                        background: 'rgba(255, 248, 225, 0.95)',
                        color: '#37474f',
                        width: '400px'
                    });
                    
                    isGpsReady = false;
                    gps = null;
                }
            } else {
                // ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï
                Swal.fire({
                    title: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ',
                    html: `
                        <div style="text-align: center; padding: 15px;">
                            <div style="font-size: 48px; margin-bottom: 15px; color: #78909c;">üö´</div>
                            <div style="font-size: 16px; color: #546e7a; margin-bottom: 10px;">
                                ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                            </div>
                            <div style="font-size: 14px; color: #78909c;">
                                ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏•‡∏∞‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
                            </div>
                        </div>
                    `,
                    icon: null,
                    confirmButtonText: '‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß',
                    confirmButtonColor: '#78909c',
                    background: 'rgba(250, 250, 250, 0.95)',
                    color: '#37474f',
                    width: '380px'
                });
                
                isGpsReady = false;
                gps = null;
            }
        }        async function ClockIn() {
            event.preventDefault();
            
            var employee = document.getElementById("employee").value;
            var userinfo = document.getElementById("userinfo").value;

            if (employee != '') {
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô
                if (!isValidEmployee(employee)) {
                    showInvalidEmployeeAlert(employee);
                    return;
                }
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö GPS - ‡πÉ‡∏ä‡πâ‡∏õ‡πá‡∏≠‡∏õ‡∏≠‡∏±‡∏û‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô (‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
                if (!isGpsReady || !gps || !hasRequestedPermission) {
                    console.log('üìç GPS not ready, requesting permission with government style popup...');
                    await requestGPSPermission();
                    
                    // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô
                    if (!isGpsReady || !gps) {
                        return; // ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡∏¢ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ requestGPSPermission ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß
                    }
                }

                $('#message').html("<span class='spinner-border spinner-border-sm text-primary'></span> ‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà ...!");
                
                try {
                    if (typeof liff !== 'undefined' && liff.isLoggedIn()) {
                        profile = liff.getDecodedIDToken();
                    }

                    console.log('‚è∞ Sending Clock In request:', {
                        employee,
                        userinfo,
                        lat: gps[0],
                        lon: gps[1]
                    });

                    const response = await fetch(apiUrl + '/clockin', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            employee,
                            userinfo,
                            lat: gps[0],
                            lon: gps[1],
                            line_name: profile ? profile.name : '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô',
                            line_picture: profile ? profile.picture : ''
                        })
                    });

                    const result = await response.json();
                    console.log('‚è∞ Clock In result:', result);
                    
                    if (result.success) {
                        setTimeout(() => {
                            var message = result.employee + '<br> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏°‡∏≤ ' + result.time;
                            $('#message').html(message);
                            document.getElementById("message").className = "alert alert-primary";
                            clearForm();
                        }, 500);
                    } else {
                        var message = result.employee + ' ' + result.message;
                        $('#message').html(message);
                        document.getElementById("message").className = "alert alert-warning";
                        clearForm();
                    }

                } catch (error) {
                    console.error('‚ùå Clock in error:', error);
                    $('#message').html('‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
                    document.getElementById("message").className = "alert alert-danger";
                    clearForm();
                }            } else {
                // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠
                Swal.fire({
                    title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô',
                    html: `
                        <div style="text-align: center; padding: 15px;">
                            <div style="font-size: 48px; margin-bottom: 15px; color: #f57c00;">üìù</div>
                            <div style="font-size: 16px; color: #d84315; margin-bottom: 10px;">
                                ‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô
                            </div>
                            <div style="font-size: 14px; color: #546e7a;">
                                ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå
                            </div>
                        </div>
                    `,
                    icon: null,
                    confirmButtonText: '‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß',
                    confirmButtonColor: '#2c5aa0',
                    background: 'rgba(255, 248, 225, 0.95)',
                    color: '#37474f',
                    width: '380px'
                });
                clearForm();
            }
        }        async function ClockOut() {
            event.preventDefault();
            
            var employee = document.getElementById("employee").value;
              if (employee != '') {
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô
                if (!isValidEmployee(employee)) {
                    showInvalidEmployeeAlert(employee);
                    return;
                }
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö GPS - ‡πÉ‡∏ä‡πâ‡∏õ‡πá‡∏≠‡∏õ‡∏≠‡∏±‡∏û‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô (‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß) ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤
                if (!isGpsReady || !gps || !hasRequestedPermission) {
                    console.log('üìç GPS not ready, requesting permission with government style popup...');
                    await requestGPSPermission();
                    
                    // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô
                    if (!isGpsReady || !gps) {
                        return; // ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡∏¢ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ requestGPSPermission ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß
                    }
                }

                $('#message').html("<span class='spinner-border spinner-border-sm text-warning'></span> ‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà ...!");
                
                try {
                    if (typeof liff !== 'undefined' && liff.isLoggedIn()) {
                        profile = liff.getDecodedIDToken();
                    }

                    console.log('‚è∞ Sending Clock Out request:', {
                        employee,
                        lat: gps[0],
                        lon: gps[1]
                    });

                    const response = await fetch(apiUrl + '/clockout', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            employee,
                            lat: gps[0],
                            lon: gps[1],
                            line_name: profile ? profile.name : '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô',
                            line_picture: profile ? profile.picture : ''
                        })
                    });

                    const result = await response.json();
                    console.log('‚è∞ Clock Out result:', result);
                    
                    if (result.success) {
                        setTimeout(() => {
                            var message = result.employee + '<br> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö ' + result.time;
                            if (result.hours) {
                                message += '<br>‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡∏ß‡∏° ' + result.hours + ' ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á';
                            }
                            $('#message').html(message);
                            document.getElementById("message").className = "alert alert-primary";
                            clearForm();
                        }, 500);
                    } else {
                        var message = result.employee + ' ' + result.message;
                        $('#message').html(message);
                        document.getElementById("message").className = "alert alert-warning";
                        clearForm();
                    }

                } catch (error) {
                    console.error('‚ùå Clock out error:', error);
                    $('#message').html('‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
                    document.getElementById("message").className = "alert alert-danger";
                    clearForm();
                }            } else {
                // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠
                Swal.fire({
                    title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô',
                    html: `
                        <div style="text-align: center; padding: 15px;">
                            <div style="font-size: 48px; margin-bottom: 15px; color: #f57c00;">üìù</div>
                            <div style="font-size: 16px; color: #d84315; margin-bottom: 10px;">
                                ‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô
                            </div>
                            <div style="font-size: 14px; color: #546e7a;">
                                ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå
                            </div>
                        </div>
                    `,
                    icon: null,
                    confirmButtonText: '‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß',
                    confirmButtonColor: '#2c5aa0',
                    background: 'rgba(255, 248, 225, 0.95)',
                    color: '#37474f',
                    width: '380px'
                });
                clearForm();
            }
        }

        $(document).ready(function () {
            let profile = null;

            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö GPS ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            initializeGPS();

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
            checkServerConnection();

            $('#clockin').click(() => ClockIn());
            $('#clockout').click(() => ClockOut());

            // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ LIFF ‡πÑ‡∏´‡∏° (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö LINE)
            if (typeof liff !== 'undefined') {
                liff.init({
                    liffId: '2006435262-Ebxr8BpG',
                    withLoginOnExternalBrowser: true
                });

                liff.ready.then(() => {
                    profile = liff.getDecodedIDToken();

                    if (profile) {
                        console.log("üöÄ LINE Profile loaded:", profile.name);
                    } else {
                        console.log("‚ö†Ô∏è No LINE profile available");
                    }

                    initApp();
                });
            } else {
                console.log("‚ö†Ô∏è LIFF not available, using fallback");
                profile = {
                    name: '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô',
                    picture: ''
                };
                initApp();
            }

            function initApp() {
                document.getElementById('message').innerText = owner;
                document.getElementById('message').className = 'alert msgBg';
                
                // ‡∏£‡∏≠‡πÉ‡∏´‡πâ jQuery UI ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
                console.log('üîß Initializing app...');
                console.log('üìö jQuery version:', $.fn.jquery);
                console.log('üìö jQuery UI loaded:', typeof $.fn.autocomplete !== 'undefined');
                
                // ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
                setTimeout(() => {
                    loadEmployees();
                }, 500);
            }
        });

        async function loadEmployees() {
            try {
                console.log('üë• Loading employees...');
                
                const response = await fetch(apiUrl + '/employees', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({})
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                console.log('üìä Employee data received:', data);
                
                if (data.success && data.data && Array.isArray(data.data)) {
                    var dataPerson = data.data;
                    console.log('üë• Employees loaded successfully:', dataPerson.length, 'employees');
                    console.log('üìã Sample employees:', dataPerson.slice(0, 3));
                    
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ jQuery UI ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
                    if (typeof $.fn.autocomplete === 'undefined') {
                        console.error('‚ùå jQuery UI Autocomplete not loaded');
                        return;
                    }                    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Autocomplete ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÅ‡∏•‡πâ‡∏ß - Fast & Accurate
                    $("#employee").autocomplete({
                        source: function(request, response) {
                            // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á - ‡∏ó‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                            const term = request.term.toLowerCase().trim();
                            
                            if (term === '') {
                                response(dataPerson.slice(0, 10)); // ‡πÅ‡∏™‡∏î‡∏á 10 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å
                                return;
                            }

                            const exactMatches = [];
                            const startsWith = [];
                            const contains = [];

                            // ‡πÉ‡∏ä‡πâ for loop ‡πÅ‡∏ó‡∏ô forEach ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß
                            for (let i = 0; i < dataPerson.length; i++) {
                                const person = dataPerson[i];
                                const personLower = person.toLowerCase();
                                
                                // 1. ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)
                                if (personLower === term) {
                                    exactMatches.push(person);
                                }
                                // 2. ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                                else if (personLower.startsWith(term)) {
                                    startsWith.push(person);
                                }
                                // 3. ‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡∏∑‡πà‡∏≠
                                else if (personLower.includes(term)) {
                                    contains.push(person);
                                }
                                
                                // ‡∏´‡∏¢‡∏∏‡∏î‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡πÅ‡∏•‡πâ‡∏ß
                                if (exactMatches.length + startsWith.length + contains.length >= 10) {
                                    break;
                                }
                            }

                            // ‡∏£‡∏ß‡∏°‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏ó‡∏µ‡πà 8 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                            const sortedMatches = [...exactMatches, ...startsWith, ...contains].slice(0, 8);
                            response(sortedMatches);
                        },
                        minLength: 1, // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå 1 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£
                        delay: 100, // ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏û‡∏µ‡∏¢‡∏á 100ms ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß
                        autoFocus: true, // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                        select: function(event, ui) {
                            // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß
                            console.log('üë§ Selected employee:', ui.item.value);
                            
                            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏ö‡∏ö toast
                            setTimeout(() => {
                                const confirmToast = Swal.mixin({
                                    toast: true,
                                    position: 'top-end',
                                    showConfirmButton: false,
                                    timer: 1500,
                                    timerProgressBar: true,
                                    background: 'rgba(76, 175, 80, 0.9)',
                                    color: 'white',
                                    width: '280px',
                                    customClass: {
                                        popup: 'fast-toast'
                                    }
                                });
                                
                                confirmToast.fire({
                                    title: `‚úÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: ${ui.item.value}`
                                });
                            }, 50);
                        },
                        focus: function(event, ui) {
                            // ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠ focus (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á log ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û)
                            return false; // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô input ‡∏Ç‡∏ì‡∏∞ focus
                        },
                        search: function(event, ui) {
                            console.log('üîç Searching for:', this.value);
                        },
                        response: function(event, ui) {
                            console.log('üìã Search results:', ui.content.length, 'items found');
                            
                            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
                            if (ui.content.length === 0 && $(this).val().trim() !== '') {
                                ui.content.push({
                                    label: 'üîç ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô - ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏´‡∏°‡πà',
                                    value: '',
                                    disabled: true
                                });
                            }
                        }
                    });
                    
                    console.log('‚úÖ Fast Autocomplete initialized successfully');
                    
                    // ‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                    validEmployees = dataPerson;
                    
                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á search index ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏£‡πá‡∏ß
                    buildEmployeeSearchIndex(dataPerson);
                    
                    console.log('‚úÖ Valid employees list updated:', validEmployees.length, 'names');
                    console.log('‚úÖ Search index built with', employeeSearchIndex.size, 'entries');
                    
                    // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Autocomplete
                    const testInput = $("#employee");
                    if (testInput.length > 0) {
                        console.log('‚úÖ Employee input field found');
                    } else {
                        console.error('‚ùå Employee input field not found');
                    }
                    
                    // ‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                    validEmployees = dataPerson.map(emp => emp.toLowerCase());
                    
                } else {
                    throw new Error(data.error || 'Invalid employee data format');
                }

            } catch (error) {
                console.error('‚ùå Failed to load employees:', error);
                $('#message').html('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ: ' + error.message);
                document.getElementById("message").className = "alert alert-warning";
                
                // ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
                console.log('üîÑ Using sample employee data for testing...');
                const sampleEmployees = [
                    '‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ',
                    '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏°‡πÉ‡∏™ ‡∏£‡∏±‡∏Å‡∏á‡∏≤‡∏ô', 
                    '‡∏ô‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏±‡∏¢ ‡∏Ç‡∏¢‡∏±‡∏ô‡∏î‡∏µ',
                    '‡∏ô‡∏≤‡∏á‡∏°‡∏ì‡∏µ ‡∏™‡∏∏‡∏†‡∏≤‡∏û',
                    '‡∏ô‡∏≤‡∏¢‡∏Å‡∏¥‡∏ï‡∏ï‡∏¥ ‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à'
                ];
                  $("#employee").autocomplete({
                    source: sampleEmployees,
                    minLength: 1,
                    delay: 100,
                    autoFocus: true
                });
                
                console.log('‚úÖ Sample autocomplete initialized');
            }
        }
        
        // ======== Employee Validation Functions - Fast & Accurate ========        let validEmployees = []; // ‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
        let employeeSearchIndex = new Map(); // ‡∏™‡∏£‡πâ‡∏≤‡∏á index ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏£‡πá‡∏ß
        let employeeCache = new Map(); // ‡πÄ‡∏Å‡πá‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÑ‡∏ß‡πâ cache
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á search index ‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡πá‡∏ß (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÅ‡∏•‡πâ‡∏ß)
        function buildEmployeeSearchIndex(employees) {
            console.log('üîß Building fast search index...');
            const startTime = Date.now();
            
            employeeSearchIndex.clear();
            employeeCache.clear();
            
            employees.forEach((employee, index) => {
                const normalizedName = employee.toLowerCase().trim();
                
                // ‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡πá‡∏°
                employeeSearchIndex.set(normalizedName, {
                    originalName: employee,
                    index: index,
                    score: 100 // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡πá‡∏°
                });
                
                // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏≥‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏≥‡πÉ‡∏ô‡∏ä‡∏∑‡πà‡∏≠
                const words = normalizedName.split(/\s+/);
                words.forEach((word, wordIndex) => {
                    if (word.length > 1) {
                        const key = `${word}_${index}`;
                        if (!employeeSearchIndex.has(key)) {
                            employeeSearchIndex.set(key, {
                                originalName: employee,
                                index: index,
                                score: 80 - (wordIndex * 5), // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏•‡∏î‡∏•‡∏á‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏≥
                                isPartial: true,
                                word: word
                            });
                        }
                    }
                });
                
                // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏≥‡∏¢‡πà‡∏≠‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö fuzzy search
                for (let i = 2; i <= Math.min(normalizedName.length, 6); i++) {
                    for (let j = 0; j <= normalizedName.length - i; j++) {
                        const substr = normalizedName.substr(j, i);
                        const key = `sub_${substr}_${index}`;
                        if (!employeeSearchIndex.has(key)) {
                            employeeSearchIndex.set(key, {
                                originalName: employee,
                                index: index,
                                score: 50 - Math.abs(j), // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
                                isSubstring: true,
                                substring: substr
                            });
                        }
                    }
                }
            });
            
            const endTime = Date.now();
            console.log(`‚úÖ Search index built: ${employeeSearchIndex.size} entries in ${endTime - startTime}ms`);
        }
          // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÅ‡∏•‡πâ‡∏ß - ‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô)
        function isValidEmployee(employeeName) {
            if (!employeeName || employeeName.trim() === '') {
                return false;
            }
            
            const normalizedInput = employeeName.toLowerCase().trim();
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å cache ‡∏Å‡πà‡∏≠‡∏ô
            if (employeeCache.has(normalizedInput)) {
                return employeeCache.get(normalizedInput);
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Å‡πà‡∏≠‡∏ô (‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)
            let isValid = false;
            if (employeeSearchIndex.has(normalizedInput)) {
                const result = employeeSearchIndex.get(normalizedInput);
                isValid = result.score === 100; // ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡πá‡∏°
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö exact match ‡∏Å‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏° (‡∏™‡∏≥‡∏£‡∏≠‡∏á)
            if (!isValid) {
                isValid = validEmployees.some(emp => emp.toLowerCase().trim() === normalizedInput);
            }
            
            // ‡πÄ‡∏Å‡πá‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÉ‡∏ô cache
            employeeCache.set(normalizedInput, isValid);
            
            return isValid;
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ô (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÅ‡∏•‡πâ‡∏ß - ‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏•‡∏∞‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏Ç‡∏∂‡πâ‡∏ô)
        function findSimilarEmployees(employeeName, limit = 3) {
            if (!employeeName) return [];
            
            const normalizedInput = employeeName.toLowerCase().trim();
            const cacheKey = `similar_${normalizedInput}_${limit}`;
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö cache ‡∏Å‡πà‡∏≠‡∏ô
            if (employeeCache.has(cacheKey)) {
                return employeeCache.get(cacheKey);
            }
            
            const suggestions = new Map(); // ‡πÉ‡∏ä‡πâ Map ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ã‡πâ‡∏≥
            const startTime = Date.now();
            
            // 1. ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å search index
            for (const [key, data] of employeeSearchIndex) {
                if (suggestions.size >= limit * 2) break; // ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û
                
                let score = 0;
                const originalName = data.originalName;
                const normalizedName = originalName.toLowerCase().trim();
                
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢
                if (normalizedName.includes(normalizedInput)) {
                    score = data.score + 20; // ‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏ñ‡πâ‡∏≤‡∏ï‡∏£‡∏á‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô
                } else if (normalizedInput.includes(normalizedName)) {
                    score = data.score + 15;
                } else {
                    // ‡πÉ‡∏ä‡πâ Levenshtein distance
                    const similarity = calculateSimilarity(normalizedInput, normalizedName);
                    if (similarity > 0.5) {
                        score = data.score + (similarity * 30);
                    }
                }
                
                if (score > 50) {
                    suggestions.set(originalName, {
                        name: originalName,
                        score: score
                    });
                }
            }
            
            // 2. ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
            const sortedSuggestions = Array.from(suggestions.values())
                .sort((a, b) => b.score - a.score)
                .slice(0, limit)
                .map(item => item.name);
            
            const endTime = Date.now();
            console.log(`üîç Found ${sortedSuggestions.length} suggestions in ${endTime - startTime}ms`);
            
            // ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô cache
            employeeCache.set(cacheKey, sortedSuggestions);
            
            return sortedSuggestions;
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Ñ‡∏•‡∏∂‡∏á‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢
        function calculateSimilarity(str1, str2) {
            const longer = str1.length > str2.length ? str1 : str2;
            const shorter = str1.length > str2.length ? str2 : str1;
            
            if (longer.length === 0) return 1.0;
            
            const editDistance = levenshteinDistance(longer, shorter);
            return (longer.length - editDistance) / longer.length;
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Levenshtein distance
        function levenshteinDistance(str1, str2) {
            const matrix = [];
            
            for (let i = 0; i <= str2.length; i++) {
                matrix[i] = [i];
            }
            
            for (let j = 0; j <= str1.length; j++) {
                matrix[0][j] = j;
            }
            
            for (let i = 1; i <= str2.length; i++) {
                for (let j = 1; j <= str1.length; j++) {
                    if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }
            
            return matrix[str2.length][str1.length];
        }
          // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÅ‡∏•‡πâ‡∏ß)
        function showInvalidEmployeeAlert(employeeName) {
            const similarNames = findSimilarEmployees(employeeName);
            
            let suggestionsHtml = '';
            if (similarNames.length > 0) {
                suggestionsHtml = `
                    <div style="margin-top: 15px; padding: 10px; background: rgba(76, 175, 80, 0.1); border-radius: 6px;">
                        <div style="font-size: 14px; color: #2c5aa0; margin-bottom: 8px; font-weight: 500;">
                            üîç ‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ô:
                        </div>
                        ${similarNames.map(name => 
                            `<div style="font-size: 13px; color: #1976d2; cursor: pointer; padding: 2px 0;" 
                                 onclick="selectSuggestedEmployee('${name.replace(/'/g, "\\'")}')">
                                ‚Ä¢ ${name}
                            </div>`
                        ).join('')}
                    </div>
                `;
            }
            
            Swal.fire({
                title: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö',
                html: `
                    <div style="text-align: center; padding: 15px;">
                        <div style="font-size: 48px; margin-bottom: 15px; color: #f57c00;">üë§</div>
                        <div style="font-size: 16px; color: #d84315; margin-bottom: 10px;">
                            "<strong>${employeeName}</strong>" ‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
                        </div>
                        <div style="font-size: 14px; color: #546e7a; line-height: 1.5; margin-bottom: 10px;">
                            ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå<br>
                            ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠
                        </div>
                        ${suggestionsHtml}
                    </div>
                `,
                icon: null,
                confirmButtonText: '‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß',
                confirmButtonColor: '#2c5aa0',
                background: 'rgba(255, 248, 225, 0.95)',
                color: '#37474f',
                width: '420px',
                customClass: {
                    popup: 'employee-suggestion-popup'
                }
            });
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
        function selectSuggestedEmployee(employeeName) {
            document.getElementById('employee').value = employeeName;
            Swal.close();
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
            const confirmToast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 2000,
                timerProgressBar: true,
                background: 'rgba(76, 175, 80, 0.9)',
                color: 'white',
                width: '280px'
            });
            
            confirmToast.fire({
                title: `‚úÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: ${employeeName}`
            });
        }

        function clearForm() {
            setTimeout(function () {
                document.getElementById('message').innerText = owner;
                document.getElementById("message").className = "alert msgBg";
                document.getElementById("myForm").reset();
            }, 5000);
        }

        /** ‡∏à‡∏≤‡∏ß‡∏≤‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤‡∏î‡∏¥‡∏à‡∏¥‡∏ï‡∏≠‡∏• **/
        function showTime() {
            var date = new Date();
            var h = date.getHours();
            var m = date.getMinutes();
            var s = date.getSeconds();
            var dot = document.textContent = '.';

            if (s % 2 == 1) {
                dot = document.textContent = '.';
            } else {
                dot = document.textContent = '\xa0';
            }

            h = h < 10 ? "0" + h : h;
            m = m < 10 ? "0" + m : m;
            s = s < 10 ? "0" + s : s;

            var time = h + ":" + m + ":" + s + '' + dot;
            document.getElementById("MyClockDisplay").innerText = time;
            document.getElementById("MyClockDisplay").textContent = time;

            setTimeout(showTime, 1000);
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
        showTime();
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ó‡∏∏‡∏Å 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        setInterval(checkServerConnection, 30000);

        // ‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£ GPS ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
        window.addEventListener('beforeunload', function() {
            if (gpsWatchId) {
                navigator.geolocation.clearWatch(gpsWatchId);
            }
        });
    </script>
    
    <!-- LIFF SDK (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö LINE) -->
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</body>
</html>
